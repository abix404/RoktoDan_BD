{% extends 'base.html' %}
{% load static %}

{% block title %}
Donor Dashboard - RoktoDan BD
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/donor_dashboard.css' %}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<main class="main">
    <div class="container">
        <!-- Welcome Section -->
        <section class="welcome-section">
            <div class="welcome-card">
                <div class="welcome-content">
                    <h2>Welcome back, {{ donor.first_name }}!</h2>
                    <p>Thank you for being a lifesaver. Your blood donation can save up to 3 lives.</p>
                </div>
                <div class="welcome-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ total_donations|default:0 }}</div>
                        <div class="stat-label">Total Donations</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ lives_saved|default:0 }}</div>
                        <div class="stat-label">Lives Saved</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Profile Card -->
            <div class="card profile-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-user"></i>
                        Profile Information
                    </h3>
                    <a href="{% url 'donor_profile_update' %}" class="edit-btn">
                        <i class="fas fa-edit"></i>
                    </a>
                </div>
                <div class="card-content">
                    <div class="profile-info">
                        <div class="profile-avatar">
                            {% if donor.profile_image %}
                                <img src="{{ donor.profile_image.url }}" alt="Profile Picture">
                            {% else %}
                                <div class="avatar-placeholder">
                                    <i class="fas fa-user"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="profile-details">
                            <div class="detail-row">
                                <span class="detail-label">Name:</span>
                                <span class="detail-value">{{ donor.full_name }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Email:</span>
                                <span class="detail-value">{{ donor.email }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Phone:</span>
                                <span class="detail-value">{{ donor.phone_number }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Blood Group:</span>
                                <span class="detail-value blood-group">{{ donor.blood_group }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Age:</span>
                                <span class="detail-value">{{ donor.age }} years</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Weight:</span>
                                <span class="detail-value">{{ donor.weight }} kg</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Donation Status Card -->
            <div class="card donation-status-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-tint"></i>
                        Donation Status
                    </h3>
                </div>
                <div class="card-content">
                    <div class="status-indicator">
                        {% if donor.can_donate %}
                            <div class="status-badge available">
                                <i class="fas fa-check-circle"></i>
                                Available to Donate
                            </div>
                            <p class="status-message">You are eligible to donate blood now!</p>
                        {% else %}
                            <div class="status-badge unavailable">
                                <i class="fas fa-clock"></i>
                                Not Available
                            </div>
                            <p class="status-message">Next donation date: {{ donor.next_donation_date }}</p>
                        {% endif %}
                    </div>
                    <div class="last-donation">
                        <h4>Last Donation</h4>
                        {% if donor.last_donation_month and donor.last_donation_year %}
                            <p>{{ donor.last_donation_month }} {{ donor.last_donation_year }}</p>
                        {% else %}
                            <p>No previous donations recorded</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Address Card -->
            <div class="card address-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Address Information
                    </h3>
                    <a href="{% url 'donor_profile_update' %}" class="edit-btn">
                        <i class="fas fa-edit"></i>
                    </a>
                </div>
                <div class="card-content">
                    <div class="address-details">
                        <p><strong>House/Holding No:</strong> {{ donor.house_holding_no }}</p>
                        <p><strong>Road/Block:</strong> {{ donor.road_block }}</p>
                        <p><strong>Thana:</strong> {{ donor.thana }}</p>
                        <p><strong>Post Office:</strong> {{ donor.post_office }}</p>
                        <p><strong>District:</strong> {{ donor.district }}</p>
                    </div>
                    <div class="full-address">
                        <strong>Full Address:</strong>
                        <p>{{ donor.full_address }}</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Card -->
            <div class="card quick-actions-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-lightning-bolt"></i>
                        Quick Actions
                    </h3>
                </div>
                <div class="card-content">
                    <div class="action-buttons">
                        <a href="{% url 'donor_profile_update' %}" class="action-btn primary">
                            <i class="fas fa-edit"></i>
                            Update Profile
                        </a>
                        <a href="{% url 'blood_request_list' %}" class="action-btn secondary">
                            <i class="fas fa-search"></i>
                            Find Requests
                        </a>
                        <a href="{% url 'donation_history' %}" class="action-btn tertiary">
                            <i class="fas fa-history"></i>
                            Donation History
                        </a>
                        <a href="{% url 'emergency_requests' %}" class="action-btn emergency">
                            <i class="fas fa-exclamation-triangle"></i>
                            Emergency Requests
                        </a>
                    </div>
                </div>
            </div>

            <!-- Health Status Card -->
            <div class="card health-status-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-heartbeat"></i>
                        Health Status
                    </h3>
                </div>
                <div class="card-content">
                    <div class="health-checklist">
                        <div class="health-item {{ donor.health_declaration|yesno:'verified,pending' }}">
                            <i class="fas {{ donor.health_declaration|yesno:'fa-check-circle,fa-times-circle' }}"></i>
                            <span>Good Health Declaration</span>
                        </div>
                        <div class="health-item {{ donor.medication_declaration|yesno:'verified,pending' }}">
                            <i class="fas {{ donor.medication_declaration|yesno:'fa-check-circle,fa-times-circle' }}"></i>
                            <span>Medication Declaration</span>
                        </div>
                        <div class="health-item {{ donor.consent_declaration|yesno:'verified,pending' }}">
                            <i class="fas {{ donor.consent_declaration|yesno:'fa-check-circle,fa-times-circle' }}"></i>
                            <span>Donation Consent</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity Card -->
            <div class="card activity-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-bell"></i>
                        Recent Activity
                    </h3>
                </div>
                <div class="card-content">
                    <div class="activity-list">
                        {% if recent_activities %}
                            {% for activity in recent_activities %}
                                <div class="activity-item">
                                    <div class="activity-icon">
                                        <i class="fas {{ activity.icon }}"></i>
                                    </div>
                                    <div class="activity-content">
                                        <p>{{ activity.message }}</p>
                                        <span class="activity-time">{{ activity.timestamp|timesince }} ago</span>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-activity">
                                <i class="fas fa-inbox"></i>
                                <p>No recent activity</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}